<!DOCTYPE html>
<html lang="pt-BR">

<head>
	<meta charset="UTF-8">
	<meta name="google-signin-scope" content="profile email">
	<meta name="google-signin-client_id" content="281275352003-nrbluthgjnach2lom1u15pct6qj0lgn0.apps.googleusercontent.com">
	<script src="https://apis.google.com/js/platform.js" async defer></script>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</head>

<body>

	<div class="col-sm-5">
		<div class="user">
				<img id="user-photo" src="https://mariovalney.com/wp-content/uploads/2015/06/user-anonimo.jpg"></img>
				<h1>Olá, <span id="user-name">visitante</span>!</h1>
				<p id="user-email"></p>
			</div>
			<div class="g-signin2 col-sm-12" data-onsuccess="onSignIn" data-theme="dark" data-longtitle="true" data-lang="pt-BR"></div>
	</div>

	<div class="col-sm-5">
		<form role="form" action="" class="form-horizontal" id="formCadastro">
			<div class="form-group">
				<div class="col-sm-4">
					<label for="nome" class="control-label">Nome</label>
				</div>
				<div class="col-sm-8">
					<input type="text" class="form-control" id="nome" name="nome" required="">
				</div>
			</div>
			<div class="form-group">
				<div class="col-sm-8">
					<label for="uf" class="control-label">Unidade da Federação</label>
				</div>
				<div class="col-sm-4">
					<select class="form-control" id="uf" name="uf">
            <option>AC</option>
            <option>AL</option>
            <option>AM</option>
            <option>BA</option>
            <option>CE</option>
            <option>DF</option>
            <option>ES</option>
            <option>GO</option>
            <option>MA</option>
            <option>MT</option>
            <option>MS</option>
            <option>MG</option>
            <option>PA</option>
            <option>PB</option>
            <option>PR</option>
            <option>PE</option>
            <option>PI</option>
            <option>RJ</option>
            <option>RN</option>
            <option>RS</option>
            <option>RO</option>
            <option>RR</option>
            <option>SC</option>
            <option>SP</option>
            <option>SE</option>
            <option>TO</option>
        </select>
				</div>
			</div>
			<div class="form-group">
				<div class="col-sm-12">
					<button type="submit" id="botaoEnviaCadastro" class="btn btn-primary col-sm-12">Cadastrar</button>
				</div>
			</div>
		</form>
	</div>

	<div id="tabelaCidades" class="col-sm-7">
		<!--aqui vem a tabela de cidades-->
	</div>

	<div class="col-sm-12">
		<form role="form" action="" id="formEndereco" class="form-horizontal">
			<fieldset>

			<!-- Form Name -->
			<legend>Endereco</legend>

			<!-- Text input-->
			<div class="form-group">
			  <label class="col-md-4 control-label" for="endLogradouro">endLogradouro</label>
			  <div class="col-md-4">
			  <input id="endLogradouro" name="endLogradouro" type="text" placeholder="END_LOGRADOURO" class="form-control input-md">

			  </div>
			</div>

			<!-- Text input-->
			<div class="form-group">
			  <label class="col-md-4 control-label" for="endBairro">endBairro</label>
			  <div class="col-md-4">
			  <input id="endBairro" name="endBairro" type="text" placeholder="endBairro" class="form-control input-md">

			  </div>
			</div>

			<!-- Text input-->
			<div class="form-group">
			  <label class="col-md-4 control-label" for="endNumero">endNumero</label>
			  <div class="col-md-4">
			  <input id="endNumero" name="endNumero" type="text" placeholder="endNumero" class="form-control input-md">

			  </div>
			</div>

			<!-- Text input-->
			<div class="form-group">
			  <label class="col-md-4 control-label" for="cidCodigo">cidCodigo</label>
			  <div class="col-md-4">
			  <input id="cidCodigo" name="cidCodigo" type="text" placeholder="cidCodigo" class="form-control input-md">

			  </div>
			</div>

			<!-- Text input-->
			<div class="form-group">
			  <label class="col-md-4 control-label" for="endLatitute">endLatitute</label>
			  <div class="col-md-4">
			  <input id="endLatitute" name="endLatitute" type="text" placeholder="endLatitute" class="form-control input-md">

			  </div>
			</div>

			<!-- Text input-->
			<div class="form-group">
			  <label class="col-md-4 control-label" for="endLongitude">endLongitude</label>
			  <div class="col-md-4">
			  <input id="endLongitude" name="endLongitude" type="text" placeholder="endLongitude" class="form-control input-md">

			  </div>
			</div>

			</fieldset>
			<div class="form-group">
				<div class="col-sm-12">
					<button type="submit" id="botaoEnviaEndereco" class="btn btn-primary col-sm-12">Cadastrar</button>
				</div>
			</div>
			</form>
	</div>
	<script>
		var id_token = 'EyJhbGciOiJSUzI1NiIsImtpZCI6ImVmMDgyMWExNWU4M2Q3YjM5MjU4ZTgyZTlmNWVhYjFlNzIzOGY4OTUifQ.eyJpc3MiOiJhY2NvdW50cy5nb29nbGUuY29tIiwiYXRfaGFzaCI6Im83UjFWN0E3SGpKZWtyNmhraGREMUEiLCJhdWQiOiIyODEyNzUzNTIwMDMtbnJibHV0aGdqbmFjaDJsb20xdTE1cGN0NnFqMGxnbjAuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJzdWIiOiIxMDY3MjgxODY1NDM4MTYxMzM2MzMiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwiYXpwIjoiMjgxMjc1MzUyMDAzLW5yYmx1dGhnam5hY2gybG9tMXUxNXBjdDZxajBsZ24wLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwiZW1haWwiOiJlc3RhZ2lhcmlvLmVsZXRyb0BnbWFpbC5jb20iLCJpYXQiOjE0NzI2MDkzOTIsImV4cCI6MTQ3MjYxMjk5MiwibmFtZSI6IlRpYWdvIFBvc3NhdG8iLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDYuZ29vZ2xldXNlcmNvbnRlbnQuY29tLy1ydVRNT2JKWUxEdy9BQUFBQUFBQUFBSS9BQUFBQUFBQUFEby9vVXdlWnFQenJiWS9zOTYtYy9waG90by5qcGciLCJnaXZlbl9uYW1lIjoiVGlhZ28iLCJmYW1pbHlfbmFtZSI6IlBvc3NhdG8iLCJsb2NhbGUiOiJwdCJ9.67B2hAE58ccTbphAhHB-pn93lFW_KixbTiNoTuy1_8sPjauRG7vAA4kf2BDuEbU4wNW_Tj0lrxQbryVcDx_S73kzmPDUQCe0ohLlAuPGjNQPAYqvu2ELvldNPYVELRhwW-BUFnKmlgjL33V7ZKU6MDCKjLZ7JovD1Ww4oawyVcQRm0c8OrdsKB-5bGPou8B3_oQMkeilQ_94b6V49dwLjqhLCkY3Lgi_NP4C5XzVT1dH6yNfgGS6p93SNldGfJxGsce50suJFuN-n2yB-enF6gEMnlNhuz-7UZfNi-p1clt3ZRT9vY-WWCLU7xtPanjQsCvKTgorEZsSveks5uDE7g';
		var access_token;
		function onSignIn(response) {
				// Conseguindo as informações do seu usuário:
				var perfil = response.getBasicProfile();
				// Conseguindo o ID do Usuário
				var userID = perfil.getId();
				// Conseguindo o Nome do Usuário
				var userName = perfil.getName();
				// Conseguindo o E-mail do Usuário
				var userEmail = perfil.getEmail();
				// Conseguindo a URL da Foto do Perfil
				var userPicture = perfil.getImageUrl();
				document.getElementById('user-photo').src = userPicture;
				document.getElementById('user-name').innerText = userName;
				document.getElementById('user-email').innerText = userEmail;
				// Recebendo o TOKEN que você usará nas demais requisições à API:
				access_token = response.getAuthResponse().access_token;
				//id_token = response.getAuthResponse().id_token;
				console.log("access_token: " + access_token);
				//access_token = 'ya29.CjBQA367SZpi--h4WRRcp-Wjihydv0zffJc55LsvPCEkjQNV_zzKIQ5QTwfWv4ReZjoe'
			};

		function leCidades() {
			$.ajax({
				url: 'http://localhost:3000/v1/cidades',
				dataType: "json",
				headers: {
					"x-access_token": access_token,
				},
				beforeSend: function(xhr) {
					$('#mdCarregando').modal('show');
				},
				success: preencheTabela,
				error: function(err){
					console.log(err);
				},
				complete: function(jqXHR, textStatus) {
					$('#mdCarregando').modal('hide');
				}
			});
		}

		function preencheTabela(listaCidades) {
			console.log(listaCidades);
			listaCidades = listaCidades.data;
			//limpa a tabela
			$('#tb-cidades').remove();
			//cria nova estrutura da tabela
			$('<tr>').attr({
				id: 'tb-head'
			}).appendTo($('<thead>').appendTo(
				$('<table>').attr({
					class: 'table table-hover table-condensed',
					id: 'tb-cidades'
				}).appendTo('#tabelaCidades')));
			$('<th>').attr({
				class: 'text-center'
			}).html('Nome').appendTo('#tb-head');
			$('<th>').attr({
				class: 'text-center'
			}).html('UF').appendTo('#tb-head');
			// $('<th>').attr({
			//     class: 'text-center'
			// }).html('Status').appendTo('#tb-head');
			$('<tboby>').appendTo('#tabelaCidades');
			//preenche a tabela com os dados recebidos
			for (var i = 0; i < listaCidades.length; i++) {
				newRow = '<tr id=\"' + listaCidades[i]['cidCodigo'] + '\" class=\"text-center\">';
				var newRow = $(newRow);
				var cols = "";
				cols += '<td>' + listaCidades[i]['cidNome'] + '</td>';
				cols += '<td>' + listaCidades[i]['ufCodigo'] + '</td>';
				// var st = 'Inativo';
				// var icone = 'fa-eye';
				// if (listaCidades[i]['isativo']) {
				//     st = 'Ativo';
				//     icone = 'fa-eye-slash';
				// }
				// cols += '<td>' + st + '</td>';
				newRow.append(cols);
				$("#tb-cidades").append(newRow);
			}
		}

		function enviaCadastro(e) {
			var dados = $(this).serialize();
			$.ajax({
				url: 'http://localhost:3000/v1/cidades',
				type: 'post',
				headers: {
					"x-access_token": access_token,
					},
				data: dados,
				success: leCidades,
				error: function(jqXHR, textStatus) {
					console.log(jqXHR.statusText);
					console.log(jqXHR.responseText);
				}
			});
			e.preventDefault();
		}

		function leEnderecos() {
			$.ajax({
				url: 'http://localhost:3000/v1/enderecos',
				dataType: "json",
				headers: {
					"x-access_token": access_token,
					},
				success: function(dados){
					console.log(dados.data)
					},
				error: function(err){
					console.log("Erro: "+ err);
				}
			});
		}

		function enviaEndereco(e) {
			var dados = $(this).serialize();
			$.ajax({
				url: 'http://localhost:3000/v1/enderecos',
				type: 'post',
				headers: {
					//"x-id_token": id_token,
					"x-access_token": access_token,
					},
				data: dados,
				}).done(function(resposta) {
					console.log(resposta);

				}).fail(function(jqXHR, textStatus ) {
					console.log("Request failed: " + textStatus);

				}).always(function() {
					console.log("completou");
				});
			e.preventDefault();
		}

			$('#formCadastro').submit(enviaCadastro);
			$('#formEndereco').submit(enviaEndereco);
			//leCidades();

	</script>
</body>

</html>
